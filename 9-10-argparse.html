
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>écrire un lanceur / point d’entrée &#8212; Python Avancé</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.5f77b4aec8189eecf79907ce328c390d.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="properties" href="9-11-properties.html" />
    <link rel="prev" title="Imports et organisation du code" href="8-10-imports-sources.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      <h1 class="site-logo" id="site-title">Python Avancé</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1-01-snake.html">
   UE12 - Python avancé
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  types de base
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2-01-numbers.html">
   les nombres
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-02-containers-1.html">
   les containers (1/2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-03-strings.html">
   chaines et binaire (
   <code class="docutils literal notranslate">
    <span class="pre">
     str
    </span>
   </code>
   et
   <code class="docutils literal notranslate">
    <span class="pre">
     bytes
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-04-files.html">
   les fichiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2-05-containers-2.html">
   les containers (2/2)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  présentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="3-11-pep008.html">
   présentation du code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  itérations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="4-11-iterations-1.html">
   les itérations en Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4-12-iterations-2.html">
   les itérations - suite
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  classes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="5-11-classes.html">
   classes : rappels (1)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5-12-dunder-specials.html">
   classes : rappels (2)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  fonctions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="6-00-intro.html">
   cours 6/9 : fonctions
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  regexps
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="7-10-regexps.html">
   expressions régulières
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  générateurs
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="7-20-generators.html">
   les générateurs
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  héritage
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="7-30-inheritance.html">
   POO &amp; héritage
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  organisation des sources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="8-10-imports-sources.html">
   Imports et organisation du code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  divers
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   écrire un lanceur / point d’entrée
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="9-11-properties.html">
   properties
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  notebooks interactifs
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="a-a1-profiling.html">
   étude de performances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="a-b1-linting.html">
   Qualité du code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="a-c3-notebooks-interactifs.html">
   Notebooks interactifs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="a-c4-animations-matplotlib.html">
   Animations interactives avec
   <code class="docutils literal notranslate">
    <span class="pre">
     matplotlib
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="a-c5-bokeh-et-al.html">
   Autres bibliothèques de visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="a-c6-fourier-k3d.html">
   Application à la transformée de Fourier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="a-x1-taylor.html">
   Le théorème de Taylor illustré
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="a-x2-coronavirus.html">
   Coronavirus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="a-x3-potentials.html">
   Tracés de champs de vitesses
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python asynchrone
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="b-01-os-basics.html">
   rappels
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="b-s1-programmation-asynchrone.html">
   programmation asynchrone
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="b-s1-z1-thread-safety.html">
   Pourquoi les
   <em>
    threads
   </em>
   c’est délicat ?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="b-s2-examples.html">
   premiers exemples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="b-s3-ecosysteme.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     asyncio
    </span>
   </code>
   : historique et écosystème
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="b-s4-async-with-for.html">
   extensions asynchrones du langage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="b-s6-av-event-loops.html">
   boucle d’événements
   <code class="docutils literal notranslate">
    <span class="pre">
     asyncio
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="b-s7-libraries.html">
   les librairies disponibles
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/9-10-argparse.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/9-10-argparse.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ue12/python-advanced"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ue12/python-advanced/issues/new?title=Issue%20on%20page%20%2F9-10-argparse.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ue12/python-advanced/edit/main/notebooks/9-10-argparse.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ue12/python-advanced/main?urlpath=tree/notebooks/9-10-argparse.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lire-les-arguments">
   lire les arguments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sys-argv">
   <code class="docutils literal notranslate">
    <span class="pre">
     sys.argv
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#les-options">
   les options
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#argparse">
   <code class="docutils literal notranslate">
    <span class="pre">
     argparse
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#packaging">
   packaging
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   conclusion
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="licence">
<span>Licence CC BY-NC-ND</span>
<span>Thierry Parmentelat</span>
</div>
<style>
.smaller {font-size: smaller}
</style><div class="section" id="ecrire-un-lanceur-point-d-entree">
<h1>écrire un lanceur / point d’entrée<a class="headerlink" href="#ecrire-un-lanceur-point-d-entree" title="Permalink to this headline">¶</a></h1>
<p>Quand on écrit un projet en Python, on peut publier uniquement une librairie : un paquet de classes, de fonctions, destinées à être utilisées depuis une autre application.</p>
<p>Il est parfois aussi utile de publier un vrai “lanceur”, c’est-à-dire un programme complet, destiné à être lancé en tant que tel avec une commande dans le terminal, genre</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python script.py
</pre></div>
</div>
<p>On appelle alors ce fichier <code class="docutils literal notranslate"><span class="pre">script.py</span></code> un <strong>lanceur</strong>, ou encore un <strong>point d’entrée</strong></p>
<div class="section" id="lire-les-arguments">
<h2>lire les arguments<a class="headerlink" href="#lire-les-arguments" title="Permalink to this headline">¶</a></h2>
<p>Il est souvent utile de pouvoir passer à ce lanceur <strong>des paramètres</strong></p>
<p>Par exemple si vous avez écrit un programme qui calcule la factorielle, on veut pouvoir passer au lanceur l’entier dont on veut calculer la factorielle, en écrivant</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python factorielle.py <span class="m">6</span>
<span class="go">factorial(6)=720</span>
</pre></div>
</div>
<p>Il nous faut donc trouver un moyen de “faire passer” ce paramètre <code class="docutils literal notranslate"><span class="pre">6</span></code> depuis le terminal jusqu’à l’application Python; pour cela on dispose de deux mécanismes :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sys.argv</span></code></p></li>
<li><p>le module <code class="docutils literal notranslate"><span class="pre">argparse</span></code></p></li>
</ul>
<p>De manière générale, sauf dans les cas simplissimes, il est préférable d’utiliser le second, bien qu’un tout petit peu plus complexe que le premier; voyons cela</p>
</div>
<div class="section" id="sys-argv">
<h2><code class="docutils literal notranslate"><span class="pre">sys.argv</span></code><a class="headerlink" href="#sys-argv" title="Permalink to this headline">¶</a></h2>
<p>Python permet de retrouver la commande de lancement du point d’entrée au travers de l’attribu <code class="docutils literal notranslate"><span class="pre">sys.argv</span></code>, sous la forme d’une liste de chaines (la commande initiale est découpée selon les espaces)</p>
<p>Considérons pour commencer le programme suivant</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %cat est une &#39;magic&#39; de IPythion</span>
<span class="c1"># qui permet d&#39;afficher le contenu de fact_sysargv.py</span>

<span class="o">%</span><span class="k">cat</span> fact_sysargv.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># on importe sys pour pouvoir accéder à sys.argv
import sys

def factorial(n):
    return 1 if n &lt;= 1 else n * factorial(n-1)

# le programme principal est souvent appelé `main`
def main():
    # sys.argv est une liste avec d&#39;abord le nom du lanceur
    # puis les paramètres de la ligne de commande
    print(f&quot;argv={sys.argv}&quot;)
    # on extrait le premier paramètre
    # qui est à l&#39;index 1 car l&#39;index 0 contient le lanceur
    number = int(sys.argv[1])
    # ya plus ka
    print(f&quot;factorial({number})={factorial(number)}&quot;)

# un idiome fréquent : pour les points d&#39;entrée
# on n&#39;exécute ceci
# **SEULEMENT** si le fichier est vraiment le point d&#39;entrée,
# et **PAS** s&#39;il est importé
if __name__ == &#39;__main__&#39;:
    main()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># avec le ! je fais comme si je tapais ça dans le terminal</span>
<span class="o">!</span>python fact_sysargv.py <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>argv=[&#39;fact_sysargv.py&#39;, &#39;6&#39;]
factorial(6)=720
</pre></div>
</div>
</div>
</div>
<p>Cette mécanique fonctionne mais présente <strong>de gros défauts</strong> :</p>
<ul class="simple">
<li><p>principalement, on ne fait <strong>aucun contrôle</strong> sur les paramètres; si vous appelez le programme avec trop ou pas assez d’arguments, il se passe des trucs pas forcément très nets</p></li>
<li><p>et si vous ne vous souvenez plus de comment il faut appeler le programme, vous en êtes quittes pour retrouver et relire le code…</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># par exemple si on essaie de lancer le programme sans le paramètre</span>
<span class="c1"># on obtient une erreur - c&#39;est normal - </span>
<span class="c1"># mais franchement ce n&#39;est pas très clair de comprendre ce qu&#39;on a mal fait</span>

<span class="o">!</span> python fact_sysargv.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>argv=[&#39;fact_sysargv.py&#39;]
Traceback (most recent call last):
  File &quot;/home/runner/work/python-advanced/python-advanced/notebooks/fact_sysargv.py&quot;, line 23, in &lt;module&gt;
    main()
  File &quot;/home/runner/work/python-advanced/python-advanced/notebooks/fact_sysargv.py&quot;, line 14, in main
    number = int(sys.argv[1])
IndexError: list index out of range
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># et avec deux paramètres, le second est simplement ignoré...</span>

<span class="o">!</span> python fact_sysargv.py <span class="m">6</span> <span class="m">20</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>argv=[&#39;fact_sysargv.py&#39;, &#39;6&#39;, &#39;20&#39;]
factorial(6)=720
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="les-options">
<h2>les options<a class="headerlink" href="#les-options" title="Permalink to this headline">¶</a></h2>
<p>en plus de tout cela, il arrive fréquemment qu’on ait envie de passer des <strong>options</strong>; par exemple, notre programme pourrait avoir deux modes d’affichage, bavard ou pas.</p>
<p>traditionnellement, les options <strong>commencent par un tiret haut</strong>, comme ceci :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># le -v est une option (v pour verbose)</span>
<span class="c1"># du coup le programme fonctionne en mode bavard</span>

<span class="o">!</span> python fact_sysargv2.py -v <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>factorial(6)=720
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sans option il marche en mode silencieux, pas de baratin</span>

<span class="o">!</span> python fact_sysargv2.py <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>720
</pre></div>
</div>
</div>
</div>
<p>Vous pouvez regarder le code de <code class="docutils literal notranslate"><span class="pre">fact_sysargv2.py</span></code> pour voir comment on a implémenté cela; notez surtout que le code devient vite un peu torturé, même pour traiter ce cas hyper-simple où on n’a qu’une seule option</p>
</div>
<div class="section" id="argparse">
<h2><code class="docutils literal notranslate"><span class="pre">argparse</span></code><a class="headerlink" href="#argparse" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">argparse</span></code> est un module de la librairie standard, conçu spécialement pour traiter de manière plus lisible ce genre de cas</p>
<p>on ne va pas ici entrer dans les détails, mais simplement montrer le code qui se comporterait comme <code class="docutils literal notranslate"><span class="pre">fact_sysargv2</span></code>.py</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">cat</span> fact_argparse.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import sys
from argparse import ArgumentParser

def factorial(n):
    return 1 if n &lt;= 1 else n * factorial(n-1)

def main():
    # on construit un objet ArgumentParser
    parser = ArgumentParser()
    # ensuite le code est déclaratif
    # on se contente de dire quel.le.s sont les options et paramètres
    parser.add_argument(&quot;-v&quot;, &quot;--verbose&quot;, default=False, action=&#39;store_true&#39;,
                        # en donnant un petit text d&#39;explication
                        help=&quot;enable verbose mode&quot;)
    # on peut aussi dire leur type, pas besoin de les convertir
    parser.add_argument(&quot;number&quot;, type=int, help=&quot;the input integer&quot;)
    
    # on déclenche l&#39;analyse de la ligne de commande
    # en fonction de ces spécifications
    args = parser.parse_args()

    # et on récupère les valeurs qui nous intéressent
    # dans les attributs du résultat de parse_args()
    verbose = args.verbose
    number = args.number

    # le reste est comme avant
    if verbose:
        print(f&quot;factorial({number})={factorial(number)}&quot;)
    else:
        print(factorial(number))

# un idiome fréquent : pour les points d&#39;entrée
# on n&#39;exécute ceci
# **SEULEMENT** si le fichier est vraiment le point d&#39;entrée,
# et **PAS** s&#39;il est importé
if __name__ == &#39;__main__&#39;:
    main()
</pre></div>
</div>
</div>
</div>
<p>ce code peut sembler un peu plus bavard que tout à l’heure; mais d’abord il donne un programme plus agréable à utiliser</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># si on ne passe pas les paramètres imposés, </span>
<span class="c1"># le programme ne fait rien, </span>
<span class="c1"># mais il nous explique comment on aurait dû l&#39;appeler</span>
<span class="o">!</span> python fact_argparse.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>usage: fact_argparse.py [-h] [-v] number
fact_argparse.py: error: the following arguments are required: number
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on peut avoir de l&#39;aide</span>
<span class="o">!</span> python fact_argparse.py --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>usage: fact_argparse.py [-h] [-v] number

positional arguments:
  number         the input integer

optional arguments:
  -h, --help     show this help message and exit
  -v, --verbose  enable verbose mode
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># et les options sont disponibles en version courte </span>
<span class="c1"># (-v comme tout à l&#39;heure)</span>
<span class="c1"># mais aussi en version longue</span>
<span class="o">!</span> python fact_argparse.py --verbose <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>factorial(6)=720
</pre></div>
</div>
</div>
</div>
<p>mais fondamentalement, le plus gros avantage c’est la lisibilité, et la simplicité de maintenance, car analyser les options “à la main” devient rapidement compliqué, fouillis, et donc peu lisible et peu maintenable.</p>
<p>pour tous les détails sur <code class="docutils literal notranslate"><span class="pre">argparse</span></code>, <a class="reference external" href="https://docs.python.org/3/howto/argparse.html">reportez-vous à ce tutoriel</a></p>
</div>
<div class="section" id="packaging">
<h2>packaging<a class="headerlink" href="#packaging" title="Permalink to this headline">¶</a></h2>
<p>on va conclure ce notebook sur une note plus avancée</p>
<p>si maintenant vous avez besoin que votre lanceur s’installe en même temps que le reste de votre librairie, vous allez utilisez <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> et écrire une clause comme ceci :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;lanceur = monpackage.fact_argparse:main&#39;</span><span class="p">,</span>
        <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>et de cette façon, après avoir installé le package avec <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> (localement ou pas), vous ou votre utilisateur pourra lancer la commande <code class="docutils literal notranslate"><span class="pre">bidule</span></code> qui sera branchée sur la fonction <code class="docutils literal notranslate"><span class="pre">main</span></code> du module <code class="docutils literal notranslate"><span class="pre">monmodule</span></code> dans le package <code class="docutils literal notranslate"><span class="pre">monpackage</span></code></p>
<p>pour davantage de détails, <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/userguide/quickstart.html#entry-points-and-automatic-script-creation">reportez-vous à la documentation de <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> à ce sujet</a></p>
</div>
<div class="section" id="conclusion">
<h2>conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>on vient de voir l’essentiel des techniques qui permettent d’écrire un lanceur en Python</p>
<p>comme vous l’avez compris on recommande d’utiliser <code class="docutils literal notranslate"><span class="pre">argparse</span></code>, de préférence à l’accès direct à <code class="docutils literal notranslate"><span class="pre">sys.argv</span></code>, qui donne un code plus lisible, plus maintenable, et beaucoup plus court dans la plupart des cas réels</p>
<p>enfin pour installer de tels lanceurs, il est préférable de sous-traiter le travail à <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>, qui se chargera de tous les détails - souvent sordides - pour une installation propre sur tous les OS de vos éventuels utilisateurs</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="8-10-imports-sources.html" title="previous page">Imports et organisation du code</a>
    <a class='right-next' id="next-link" href="9-11-properties.html" title="next page">properties</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Thierry Parmentelat<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>